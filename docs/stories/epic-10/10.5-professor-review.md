# Story 10.5: Professor Review

**Epic:** Dialog Roleplay Tutor
**Priority:** High
**Effort:** 2 hours
**Dependencies:** Story 10.4 (End Session)

---

## User Story

**As a** student
**I want to** see a professor's review of my dialog performance
**So that** I understand my strengths and areas for improvement

---

## Acceptance Criteria

- [ ] POST `/api/tutor/dialog/review` endpoint created
- [ ] Professor review generated via LangChain
- [ ] Review shows: rating, summary, strengths, improvements
- [ ] Error breakdown by category (grammar/vocab/syntax)
- [ ] ProfessorReview component displays review
- [ ] Encouraging, positive tone maintained
- [ ] Review appears before transcript

---

## Technical Tasks

1. Create `app/api/tutor/dialog/review/route.ts`
   - Fetch session data
   - Fetch all dialog turns
   - Calculate error breakdown by category
   - Generate review using `generateProfessorReviewTool`
   - Return formatted review

2. Reuse existing `ProfessorReview` component
   - Import from `components/tutor/ProfessorReview.tsx`
   - Pass review data as props
   - No modifications needed (already styled)

3. Update `DialogRoleplayPanel.tsx` - Review Stage
   - Call review API after session ends
   - Display loading state during generation
   - Render ProfessorReview component
   - Show "Start New Roleplay" button below

---

## API Contract

### Request
```typescript
POST /api/tutor/dialog/review
{
  sessionId: string,
  level: CEFRLevel,
  errors: ErrorAnalysis[]
}
```

### Response
```typescript
{
  review: {
    rating: 'Excelente' | 'Muy Bien' | 'Bien' | 'Necesita Pr√°ctica',
    summary: string,
    strengths: string[],
    improvements: string[],
    errorBreakdown: {
      grammar: number,
      vocabulary: number,
      syntax: number
    }
  }
}
```

---

## Rating Logic

- **Excelente:** 0-2 errors total
- **Muy Bien:** 3-5 errors total
- **Bien:** 6-8 errors total
- **Necesita Pr√°ctica:** 9+ errors total

---

## Review Display

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä Professor Review                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                     ‚îÇ
‚îÇ  Rating: ‚≠ê‚≠ê‚≠ê‚≠ê Muy Bien            ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  Summary:                           ‚îÇ
‚îÇ  ¬°Excelente trabajo! Tu conversaci√≥n‚îÇ
‚îÇ  fue natural y fluida. Mostraste un ‚îÇ
‚îÇ  buen dominio del vocabulario...    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üí™ Strengths:                      ‚îÇ
‚îÇ  ‚Ä¢ Uso correcto de verbos regulares ‚îÇ
‚îÇ  ‚Ä¢ Vocabulario variado y apropiado  ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìà Areas for Improvement:          ‚îÇ
‚îÇ  ‚Ä¢ Concordancia de g√©nero           ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  üìä Error Breakdown:                ‚îÇ
‚îÇ  Grammar: 2  Vocabulary: 1  Syntax: 0‚îÇ
‚îÇ                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## AI System Prompt

```typescript
`Eres un profesor de espa√±ol experimentado y ALENTADOR evaluando a un estudiante de nivel ${level}.

CONVERSACI√ìN:
${transcript}

ERRORES COMETIDOS (${errors.length} total):
${errors.map(e => `- ${e.errorText} ‚Üí ${e.correction} (${e.category})`).join('\n')}

Proporciona una evaluaci√≥n POSITIVA Y ALENTADORA con:
1. Calificaci√≥n apropiada basada en n√∫mero de errores
2. Resumen alentador (2-3 oraciones)
3. 2-3 fortalezas espec√≠ficas
4. 1-2 sugerencias constructivas
5. Desglose de errores por categor√≠a

IMPORTANTE:
- SIEMPRE s√© positivo y motivador
- Enf√≥cate en el progreso, no solo en errores
- Usa espa√±ol natural y c√°lido`
```

---

## Test Cases

1. **Review generation:** Valid session ‚Üí review created successfully
2. **Correct rating:** Error count maps to correct rating
3. **Error breakdown:** Categories counted correctly
4. **Encouraging tone:** Review uses positive language
5. **Component display:** ProfessorReview renders properly
6. **Loading state:** Spinner shown during generation

---

## Definition of Done

- [ ] API endpoint implemented
- [ ] LangChain integration complete
- [ ] ProfessorReview component integrated
- [ ] Review displays correctly
- [ ] All acceptance criteria met
- [ ] Manual testing with various error counts
- [ ] Tone is consistently encouraging
