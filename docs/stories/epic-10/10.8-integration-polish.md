# Story 10.8: Integration & Polish

**Epic:** Dialog Roleplay Tutor
**Priority:** Medium
**Effort:** 2 hours
**Dependencies:** All previous stories (10.1-10.6)

---

## User Story

**As a** student
**I want** a smooth, polished experience
**So that** practicing dialogs feels natural and engaging

---

## Acceptance Criteria

- [ ] Loading spinners during all API calls
- [ ] Error handling with user-friendly messages
- [ ] Toast notifications for success/errors
- [ ] Smooth transitions between stages
- [ ] Responsive layout on mobile
- [ ] Keyboard shortcuts (Enter to submit, Escape to cancel)
- [ ] No console errors or warnings
- [ ] Proper focus management

---

## Technical Tasks

### 1. Loading States
- [ ] Spinner during session start
- [ ] Spinner during each conversation turn
- [ ] Spinner during review generation
- [ ] Disable inputs during loading
- [ ] Visual feedback for all async operations

### 2. Error Handling
- [ ] API error boundaries
- [ ] Network timeout handling
- [ ] Graceful degradation for LLM failures
- [ ] User-friendly error messages
- [ ] Retry mechanisms for failed requests

### 3. Toast Notifications
- [ ] Success toast: "Session started!"
- [ ] Success toast: "Review generated!"
- [ ] Error toast: "Failed to start session. Please try again."
- [ ] Error toast: "Failed to generate response. Retrying..."
- [ ] Info toast: "Session ended. Analyzing performance..."

### 4. Transitions & Animations
- [ ] Fade in/out between stages
- [ ] Smooth scroll to new messages
- [ ] Button hover states
- [ ] Loading spinner animations
- [ ] Modal open/close animations

### 5. Responsive Design
- [ ] Mobile layout (< 768px)
- [ ] Tablet layout (768px - 1024px)
- [ ] Desktop layout (> 1024px)
- [ ] Touch-friendly button sizes
- [ ] Readable text on small screens

### 6. Keyboard Shortcuts
- [ ] Enter: Submit message (when input focused)
- [ ] Escape: Close modal/cancel action
- [ ] Ctrl+Enter: Force submit (even if disabled)
- [ ] Tab: Navigate through form fields

### 7. Focus Management
- [ ] Auto-focus input field after AI responds
- [ ] Focus trap in modals
- [ ] Restore focus after modal closes
- [ ] Skip navigation for screen readers

### 8. Accessibility
- [ ] ARIA labels for all interactive elements
- [ ] Keyboard navigation works throughout
- [ ] Screen reader announcements for AI messages
- [ ] Color contrast meets WCAG AA standards

---

## Error Messages

### User-Friendly Errors
- âŒ "Network error" â†’ âœ… "Connection lost. Check your internet and try again."
- âŒ "500 Internal Server Error" â†’ âœ… "Something went wrong. We're looking into it."
- âŒ "Validation failed" â†’ âœ… "Please fill in all required fields."
- âŒ "LLM timeout" â†’ âœ… "The AI is taking longer than expected. Retrying..."

---

## Toast Examples

```typescript
// Success
toast.success('ðŸŽ­ Roleplay session started!')

// Error with retry
toast.error('Failed to generate response. Retrying...', {
  action: {
    label: 'Retry Now',
    onClick: () => retryTurn()
  }
})

// Info
toast.info('Analyzing your performance...')
```

---

## Responsive Breakpoints

```css
/* Mobile */
@media (max-width: 767px) {
  - Stack buttons vertically
  - Full-width inputs
  - Larger touch targets (min 44px)
  - Hide secondary info
}

/* Tablet */
@media (min-width: 768px) and (max-width: 1023px) {
  - Side-by-side layout
  - Medium button sizes
  - Show condensed info
}

/* Desktop */
@media (min-width: 1024px) {
  - Full feature set
  - Hover states
  - Tooltips
  - Multi-column layouts
}
```

---

## Loading State Examples

```tsx
// Button loading
<button disabled={isLoading}>
  {isLoading ? (
    <>
      <Loader2 className="animate-spin" />
      <span>Starting...</span>
    </>
  ) : (
    'Start Roleplay'
  )}
</button>

// Overlay loading
{isGeneratingReview && (
  <div className="loading-overlay">
    <Loader2 className="animate-spin" />
    <p>Analyzing your performance...</p>
  </div>
)}
```

---

## Test Cases

### Loading States
1. **Session start:** Spinner shown until first AI message
2. **Turn processing:** Input disabled, button shows spinner
3. **Review generation:** Full-screen loading overlay

### Error Handling
1. **Network error:** Friendly message + retry button
2. **API error:** Graceful fallback, session not lost
3. **LLM timeout:** Auto-retry once, then show error

### Notifications
1. **Success toast:** Shown for successful actions
2. **Error toast:** Shown for failures
3. **Info toast:** Shown for in-progress operations

### Responsive
1. **Mobile:** Layout works on iPhone SE
2. **Tablet:** Layout works on iPad
3. **Desktop:** Full features on 1920x1080

### Keyboard
1. **Enter key:** Submits message
2. **Escape key:** Closes modals
3. **Tab key:** Navigates through form

### Accessibility
1. **Screen reader:** Announces AI messages
2. **Keyboard nav:** All features accessible
3. **Color contrast:** Passes WCAG AA

---

## Definition of Done

- [ ] All loading states implemented
- [ ] All error handling in place
- [ ] Toast notifications working
- [ ] Smooth transitions
- [ ] Responsive on all screen sizes
- [ ] Keyboard shortcuts functional
- [ ] Accessibility compliant
- [ ] No console errors
- [ ] Manual testing complete on:
  - [ ] Chrome desktop
  - [ ] Safari mobile
  - [ ] Firefox
- [ ] Code reviewed and approved
