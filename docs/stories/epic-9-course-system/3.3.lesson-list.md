# Story 3.3: Lesson List Page

## Status
Draft

## Story
**As a** learner,
**I want** to view all lessons in a course with progress tracking,
**so that** I can navigate to lessons and see my completion status.

## Acceptance Criteria
1. `/courses/[id]` page created (protected route)
2. Page displays course title, description, and total XP
3. Lesson list shows: lesson number, title, XP value, completion status
4. Completed lessons show checkmark badge
5. Locked lessons (incomplete prerequisites) show lock icon
6. Clicking lesson navigates to `/lessons/[id]`
7. Progress bar shows overall course completion percentage
8. Mobile-responsive list layout

## Tasks / Subtasks

- [ ] Create lesson list page `app/courses/[id]/page.tsx` (AC: 1, 2)
  - [ ] Get course ID from params: `params.id`
  - [ ] Fetch course details with lessons from Supabase
  - [ ] Fetch user's lesson completions
  - [ ] Pass data to client component

- [ ] Create lesson list component (AC: 3, 4, 5, 6, 8)
  - [ ] Create `components/courses/LessonList.tsx`
  - [ ] Map lessons to lesson cards
  - [ ] Show lesson number (sequence_order), title, XP value
  - [ ] Show completion checkmark if completed
  - [ ] Show lock icon if locked (previous lesson incomplete)
  - [ ] OnClick: navigate to `/lessons/${lesson.id}`

- [ ] Implement prerequisite logic (AC: 5)
  - [ ] Lesson unlocked if:
    - First lesson (sequence_order === 1) OR
    - Previous lesson completed
  - [ ] Check previous lesson completion:
    ```typescript
    const isUnlocked = lesson.sequence_order === 1 ||
      completedLessonIds.includes(lessons[index - 1].id);
    ```

- [ ] Fetch course with lessons (AC: 2, 3)
  - [ ] Update `lib/services/courses.ts`:
    ```typescript
    export async function getCourseWithLessons(courseId: string, userId: string) {
      const supabase = createClient();
      const { data: course } = await supabase
        .from('courses')
        .select(`
          *,
          lessons (*)
        `)
        .eq('id', courseId)
        .order('lessons.sequence_order')
        .single();

      const { data: completions } = await supabase
        .from('lesson_completions')
        .select('lesson_id')
        .eq('user_id', userId);

      return {
        ...course,
        completedLessonIds: completions?.map(c => c.lesson_id) || []
      };
    }
    ```

- [ ] Add progress bar (AC: 7)
  - [ ] Use `ProgressBar` component (Story 3.5)
  - [ ] Calculate progress: `completedLessons / totalLessons`
  - [ ] Display above lesson list

- [ ] Test lesson list (AC: 1-8)
  - [ ] Navigate to `/courses/{course-id}`
  - [ ] Verify course title and description display
  - [ ] Verify lessons ordered by sequence
  - [ ] Complete first lesson, verify checkmark appears
  - [ ] Verify second lesson unlocked
  - [ ] Verify third lesson locked (if second incomplete)
  - [ ] Click lesson, verify navigation
  - [ ] Test mobile view

## Dev Notes
See architecture doc lines 669-682 for `/api/courses/[id]` spec.

## Testing
**E2E:** Complete lesson, verify progress updates, next lesson unlocks.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-02 | 1.0 | Initial story | Bob |

## Dev Agent Record
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
