# Story 3.2: Course List Page

## Status
Draft

## Story
**As a** learner,
**I want** to browse all available courses,
**so that** I can explore learning options and select courses to start.

## Acceptance Criteria
1. `/courses` page created (protected route)
2. Page displays all courses with level filtering
3. Course cards show: title, description, level badge, total lessons, XP total
4. Clicking course card navigates to `/courses/[id]` (lesson list)
5. Level filter buttons: All | A1 | A2 | B1 | B2 | C1 | C2
6. Mobile-responsive grid layout
7. Empty state shown when no courses match filter

## Tasks / Subtasks

- [ ] Create course list page `app/courses/page.tsx` (AC: 1)
  - [ ] Create Server Component
  - [ ] Add page metadata: title "Courses - Interlinear"
  - [ ] Fetch all courses from Supabase
  - [ ] Pass courses to client component for filtering

- [ ] Create course list component `components/courses/CourseList.tsx` (AC: 2, 3, 6)
  - [ ] Accept `courses` prop (array of Course objects)
  - [ ] Use Client Component for filter state: `'use client'`
  - [ ] Implement level filter state: `const [filter, setFilter] = useState<string>('All')`
  - [ ] Filter courses based on selected level
  - [ ] Render course cards in grid: `grid-cols-1 md:grid-cols-2 lg:grid-cols-3`

- [ ] Create level filter component (AC: 5)
  - [ ] Create `components/courses/LevelFilter.tsx`
  - [ ] Render filter buttons: All, A1, A2, B1, B2, C1, C2
  - [ ] Active filter styling: `bg-blue-600 text-white`
  - [ ] Inactive: `bg-gray-200 text-gray-700 hover:bg-gray-300`
  - [ ] OnClick: `setFilter(level)`

- [ ] Render course cards (AC: 3, 4)
  - [ ] Use `CourseCard` component (Story 3.5)
  - [ ] Pass course data: title, description, level, total_lessons, xp_total
  - [ ] OnClick: navigate to `/courses/${course.id}`
  - [ ] Use Next.js Link for navigation

- [ ] Fetch courses data (AC: 2)
  - [ ] Update `lib/services/courses.ts`:
    ```typescript
    export async function getAllCourses() {
      const supabase = createClient();
      const { data, error } = await supabase
        .from('courses')
        .select(`
          *,
          lessons (id)
        `)
        .order('level');

      if (error) throw error;

      return data.map(course => ({
        ...course,
        total_lessons: course.lessons.length
      }));
    }
    ```

- [ ] Add empty state (AC: 7)
  - [ ] Create `components/courses/EmptyState.tsx`
  - [ ] Show when `filteredCourses.length === 0`
  - [ ] Message: "No courses found for level {filter}"
  - [ ] CTA: "Try a different level" or "Browse all courses"

- [ ] Test course list (AC: 1-7)
  - [ ] Navigate to `/courses`
  - [ ] Verify all courses display
  - [ ] Click level filter, verify courses filtered
  - [ ] Click course card, verify navigation to `/courses/[id]`
  - [ ] Test mobile view (grid stacks vertically)
  - [ ] Filter to level with no courses, verify empty state

## Dev Notes

### Page Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Courses                             â”‚
â”‚ â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”      â”‚
â”‚ â”‚Allâ”‚A1 â”‚A2 â”‚B1 â”‚B2 â”‚C1 â”‚C2 â”‚      â”‚ (Level filter)
â”‚ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ A1   â”‚ â”‚ A2   â”‚ â”‚ B1   â”‚         â”‚ (Course cards)
â”‚ â”‚Courseâ”‚ â”‚Courseâ”‚ â”‚Courseâ”‚         â”‚
â”‚ â”‚10 ðŸŽ“ â”‚ â”‚12 ðŸŽ“ â”‚ â”‚15 ðŸŽ“ â”‚         â”‚
â”‚ â”‚1000XPâ”‚ â”‚1500XPâ”‚ â”‚2000XPâ”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Level Filter Implementation
```typescript
function filterCourses(courses: Course[], level: string) {
  if (level === 'All') return courses;
  return courses.filter(c => c.level === level);
}

const filteredCourses = filterCourses(courses, selectedLevel);
```

### Course Card Data
Each course card needs:
- `title`: "Spanish A1 Course"
- `description`: "For absolute beginners"
- `level`: "A1"
- `total_lessons`: 10
- `xp_total`: 1000
- `completedLessons`: User-specific progress (fetch from `lesson_completions`)

### Source Tree
```
app/
  courses/
    page.tsx              # New course list page
components/
  courses/
    CourseList.tsx        # New list component
    LevelFilter.tsx       # New filter component
    EmptyState.tsx        # New empty state
    CourseCard.tsx        # From Story 3.5
lib/
  services/
    courses.ts            # Updated with getAllCourses
```

### Testing

**Test File Location:** `components/courses/CourseList.test.tsx`

**Unit Tests:**
```typescript
describe('CourseList', () => {
  const mockCourses = [
    { id: '1', title: 'A1 Course', level: 'A1', total_lessons: 10, xp_total: 1000 },
    { id: '2', title: 'A2 Course', level: 'A2', total_lessons: 12, xp_total: 1500 }
  ];

  it('displays all courses by default', () => {
    render(<CourseList courses={mockCourses} />);
    expect(screen.getByText('A1 Course')).toBeInTheDocument();
    expect(screen.getByText('A2 Course')).toBeInTheDocument();
  });

  it('filters courses by level', () => {
    render(<CourseList courses={mockCourses} />);
    fireEvent.click(screen.getByText('A1'));
    expect(screen.getByText('A1 Course')).toBeInTheDocument();
    expect(screen.queryByText('A2 Course')).not.toBeInTheDocument();
  });

  it('shows empty state when no courses match filter', () => {
    render(<CourseList courses={mockCourses} />);
    fireEvent.click(screen.getByText('C1'));
    expect(screen.getByText(/No courses found/)).toBeInTheDocument();
  });
});
```

**E2E Tests:** `tests/e2e/course-navigation.spec.ts`
```typescript
test('browse and filter courses', async ({ page }) => {
  await page.goto('/courses');

  // Verify courses display
  await expect(page.locator('text=Spanish A1 Course')).toBeVisible();

  // Filter by A1
  await page.click('button:has-text("A1")');
  await expect(page.locator('text=Spanish A2 Course')).not.toBeVisible();

  // Click course card
  await page.click('text=Spanish A1 Course');
  await expect(page).toHaveURL(/\/courses\/.+/);
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-02 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
